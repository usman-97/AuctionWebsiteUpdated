<?php require('template/header.phtml') ?>

<!-- Page Heading/Breadcrumbs -->
<h1 class="mt-4 mb-3"><?php echo $view->pageTitle; ?>
    <small> </small>
</h1>

<ol class="breadcrumb">
    <li class="breadcrumb-item">
        <a href="index.php">Home</a>
    </li>
    <li class="breadcrumb-item active"><?php echo $view->pageTitle; ?></li>
</ol>

<!-- Search bar -->
<div class="breadcrumb">
    <div class="searchBar">
        <p>You can search item lot by Lot Title, Lot Main or Auction.</p>
        <form action="<?php $_SERVER['PHP_SELF'] ?>" method="post">
            <input type="text" name="searchBar" value="<?php if (isset($view->currentSearchItem)) {echo $view->currentSearchItem;} ?>" placeholder="search. . .">
            <input type="hidden" name="saveSearch" value="<?php if (isset($view->currentSearchItem)) {$view->currentSearchItem;} ?>">
            <button type="submit" name="searchButton" class="btn btn-info">Search</button>
            <?php if (isset($_SESSION['searchMode'])) : ?>
                <button type="submit" name="clearSearch" class="btn btn-danger">Clear</button>
                <br />
                <div>
                    <?php /*for ($i = 1; $i <   $view->totalPages; $i++)
                {
                    echo '<button type="submit" name="page">'. $i .'</button>';
                }*/?>
                    <input type="hidden" name="pageLimit" value="<?php if (isset($view->currentLimit)) {echo $view->currentLimit;} ?>">
                    <input type="hidden" name="savePageLimit" value="<?php if (isset($view->currentLimit)) {echo $view->currentLimit;} ?>">
                    <!--<button id="loadPages" type="submit" name="morePages" class="btn btn-primary">Load more results</button>
                    <button id="lessPages" type="submit" name="lessPages" class="btn btn-primary">few results</button>-->
                </div>
                <br />
            <?php endif; ?>

            <!-- Filters -->
            <div>
                <label>Filter: </label>
                <select name="filters">
                    <option value="<?php if (isset($view->filter)) {echo $view->filter;}?>">-</option>
                    <option value="ascendingOrder">A - Z</option>
                    <option value="descendingOrder">Z - A</option>
                    <option value="popular">Most Popular</option>
                    <option value="recent">Most Recent</option>
                </select>
                <input type="hidden" name="filterOption" value="<?php if (isset($view->filter)) {echo $view->filter;}?>">
                <?php if (isset($_SESSION['searchMode'])) : ?>
                    <button type="submit" name="clearFilter" class="btn btn-secondary">Clear</button>
                <?php endif; ?>
            </div>
            <div><p class="error"><?php if (isset($view->error)) {echo $view->error;} ?></p></div>
    </div>
</div>

<div class="page">
    <p><i><?php if (isset($view->totalRecords)) {echo 'Total - ' . $view->totalRecords;} ?>
    <?php if (isset($_GET['page'])) {
                echo 'Page ' . $_GET['page'];
            }
        else
        {
            echo 'Page 1';
        }?></i></p>
</div>

<form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="post">
    <input type="hidden" name="saveAuctionName" value="<?php if (isset($view->nameOfAuction)) {echo $view->nameOfAuction;} ?>">
    <br>

    <!-- Listings -->
    <div id="listing" class="row">
        <?php $num = 1;
        foreach ($view->auctionItem as $auctionItemData) {
            // echo $num;
            echo '<div class="col-lg-6 portfolio-item"><form action="" method="post"><div class="card h-100">' .
                '<h4 class="card-header">Lot ID #' . $auctionItemData->getLotID() .
                ': ' . $auctionItemData->getLotTitle() . ' - ' . $auctionItemData->getLotMain() . '</h4>' .
                '<img src="images/' . $auctionItemData->getImage() . '.jpg">' .
                '<input type="hidden" name="lotImage" value="' . $auctionItemData->getImage() . '.jpg">' .
                '<div class="card-body">' .
                '<h5><b>' . $auctionItemData->getAuctionName() . '</b></h5>' .
                '<p class="card-text">' . $auctionItemData->getDescription() . '</p>' .
                '<p class="card-text"><b>Opening bid Price: Â£' . $auctionItemData->getPrice() . '</b></p>' .
                '<p style="color: #4e555b"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-geo-alt-fill" viewBox="0 0 16 16">
                        <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                    </svg><b><i>' . $auctionItemData->getLocation() . '</i></b></p>' .
                '<p id="startTime" style="color: #4e555b"><b>' . $auctionItemData->getDatetime() . ' GMT</b></p>' .
                '<p id="countDownTimer' . $num .'">start</p>' .
                /*'<p id="countDownTimer2">start</p>' .
                '<p id="countDownTimer3">start</p>' .
                '<p id="countDownTimer4">start</p>' .
                '<p id="countDownTimer5">start</p>' .
                '<p id="countDownTimer6">start</p>' .
                '<p id="countDownTimer7">start</p>' .
                '<p id="countDownTimer8">start</p>' .
                '<p id="countDownTimer9">start</p>' .
                '<p id="countDownTimer10">start</p>' .
                '<p id="countDownTimer11">start</p>' .
                '<p id="countDownTimer12">start</p>' .
                '<p id="countDownTimer13">start</p>' .
                '<p id="countDownTimer14">start</p>' .
                '<p id="countDownTimer15">start</p>' .
                '<p id="countDownTimer16">start</p>' .
                '<p id="countDownTimer17">start</p>' .
                '<p id="countDownTimer18">start</p>' .
                '<p id="countDownTimer19">start</p>' .
                '<p id="countDownTimer20">start</p>' .*/
                '<input id="lot_id" type="hidden" name="lotID" value="' . $auctionItemData->getLotId() . '">' .
                '<input type="hidden" name="lotTitle" value="' . $auctionItemData->getLotTitle() . '">' .
                '<input type="hidden" name="lotMain" value="' . $auctionItemData->getLotMain() . '">' .
                '<input type="hidden" name="lotDescription" value="' . $auctionItemData->getDescription() . '">' .
                '<input type="hidden" name="lotPrice" value="' . $auctionItemData->getPrice() . '">' .
                '<input type="hidden" name="auctionID" value="' . $auctionItemData->getAuctionID() . '">' .
                '<input type="hidden" name="auctionName" value="' . $auctionItemData->getAuctionName() . '">' .
                '<input type="hidden" name="auctionLocation" value="' . $auctionItemData->getLocation() . '">' .
                '<input id="start" type="hidden" name="auctionDatetime" value="' . $auctionItemData->getDatetime() . '">' .
                '<input id="endDateTime" type="hidden" name="auctionEndDatetime" value="' . $auctionItemData->getEndDatetime() . '">' .
                '<input type="hidden" name="auctionAdmin" value="' . $view->auctionItemDateSet->getAuctionAdmin(intval($auctionItemData->getUserID())) . '">' .
                '<input id="trackCount" type="hidden" name="auctionAdmin" value="' . $num . '">' .
                '</div><div class="card-footer"><input type="submit" name="view" value="View" class="btn btn-primary"/></div></div></form></div>';
            $num++;
        }?>
    </div>
    <br />
    <script type="text/javascript">
        var start = document.getElementById("start").value;
        var endDate = document.getElementById("endDateTime").value;
        // var timer = document.getElementById("countDownTimer");
        var startTime = document.getElementById("startTime");
        // console.log("countdowntimer" + 1);
        // console.log(document.getElementById("countDownTimer"));

        function CountDown()
        {
            let startDate = new Date(start);
            console.log(startDate);
            let countDownTime = new Date(endDate).getTime();
            let now = new Date().getTime();
            // console.log(new Date(start));
            // console.log();

            if (startDate <= now)
            {
                let x = setInterval(function () {
                    let now = new Date().getTime();
                    let difference = countDownTime - now;
                    // console.log(difference);

                    let days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    let hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                    let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                    let seconds = Math.floor((difference % (1000 * 60)) / 1000);
                    // console.log(days);

                    for (var i = 1; i <= 20; i++)
                    {
                        document.getElementById("countDownTimer" + i).innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                        startTime.innerHTML = "LIVE";
                        // console.log("countDownTimer" + i);

                        if (difference < 0)
                        {
                            clearInterval(x);
                            document.getElementById("countDownTimer" + i).innerText = "END";
                        }
                    }
                }, 1000)
            }
        }

        var x = new CountDown();
        // window.onload = new CountDown();

        /*var start = document.getElementById("start").value;
        var endDate = document.getElementById("endDateTime").value;
        // var timer = document.getElementById("countDownTimer");
        var startTime = document.getElementById("startTime");
        // console.log("countdowntimer" + 1);
        // console.log(document.getElementById("countDownTimer"));

        function CountDown(event)
        {
            let startDate = new Date(start);
            let countDownTime = new Date(endDate).getTime();
            let now = new Date().getTime();
            // console.log(new Date(start));
            // console.log();

            if (startDate <= now)
            {
                let x = setInterval(function () {
                    let now = new Date().getTime();
                    let difference = countDownTime - now;
                    // console.log(difference);

                    let days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    let hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                    let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                    let seconds = Math.floor((difference % (1000 * 60)) / 1000);
                    // console.log(days);

                    for (var i = 1; i <= 20; i++)
                    {
                        document.getElementById("countDownTimer" + i).innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                        startTime.innerHTML = "LIVE";

                        if (difference < 0)
                        {
                            clearInterval(x);
                            document.getElementById("countDownTimer" + i).innerText = "END";
                        }
                    }
                }, 1000)
            }
        }

        x = new CountDown();*/
        // x.startCoundownTimer();
        // window.addEventListener(\'load\', countDown, true);
        // window.onload = x.startCountdownTimer;

        /*var start = document.getElementById("start").value;
        var endDate = document.getElementById("endDateTime").value;
        var timer = document.getElementById("countDownTimer");
        var startTime = document.getElementById("startTime");

        function CountDown()
        {
            let startDate = new Date(start);
            let countDownTime = new Date(endDate).getTime();
            let now = new Date().getTime();
            // console.log(new Date(start));
            // console.log(document.getElementById("lot_id"));

            if (startDate <= now)
            {
                let x = setInterval(function () {
                    let now = new Date().getTime();
                    let difference = countDownTime - now;
                    // console.log(difference);

                    let days = Math.floor(difference / (1000 * 60 * 60 * 24));
                    let hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                    let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                    let seconds = Math.floor((difference % (1000 * 60)) / 1000);
                    // console.log(days);

                    timer.innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                    startTime.innerHTML = "LIVE";

                    if (difference < 0)
                    {
                        clearInterval(x);
                        document.getElementById("countDownTimer").innerText = "END";
                    }
                }, 1000)
            }
        }

        x = new CountDown();*/

        /*function countDown()
        {
            var endDate = document.getElementById("endDateTime").value;
            var countDownTime = new Date(endDate).getTime();
            console.log(new Date(endDate));
            // console.log(new Date("2021-04-14 22:00"));

            var x = setInterval(function () {
                let now = new Date().getTime();
                let difference = countDownTime - now;
                // console.log(difference);

                let days = Math.floor(difference / (1000 * 60 * 60 * 24));
                let hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
                let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
                let seconds = Math.floor((difference % (1000 * 60)) / 1000);
                // console.log(days);

                document.getElementById("countDownTimer").innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
                document.getElementById("startTime").innerHTML = "LIVE";

                if (difference < 0)
                {
                    clearInterval(x);
                    document.getElementById("countDownTimer").innerText = "END";
                }
            }, 1000)
        }

        x = new countDown();*/

        // function countDown() {
        //     let now = new Date().getTime();
        //     let difference = now - countDownTime;
        //     // console.log(difference);
        //
        //     let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        //     let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
        //     let seconds = Math.floor((difference % (1000 * 60)) / 1000);
        //
        //     document.getElementById("countDownTimer").innerHTML = hours + "h " + minutes + "m " + seconds + "s ";
        //
        //     if (difference < 0)
        //     {
        //         clearInterval(this);
        //         document.getElementById("countDownTimer").innerText = "END";
        //     }
        // }
        // var x = setInterval(countDown(), 1000);
        // console.log(x);
    </script>

    <!-- Pagination -->
    <?php /*if (!isset($_SESSION['searchMode'])) : */?>

        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="<?php if (isset($view->previous)) {echo $view->previous;} ?>" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            <li class="page-item">
                <?php
                if (isset($view->currentPage)) {
                    for ($page = $_GET['page'] - $view->currentPage; ($page <= $_GET['page'] + $view->currentPage) && ($page < $view->totalPages + 1); $page++) {
                        if ($page == 1)
                        {
                            for ($j = 1; $j < 5; $j++)
                            {
                                echo '<div style="display: inline-block;"><a class="page-link" href="auctionItem.php?page=' . $page . '">' . $page . '</a></div>';
                                $page++;
                                $_SESSION['auctionItem'] = true;
                            };
                        }

                        echo '<div style="display: inline-block;"><a class="page-link" href="auctionItem.php?page=' . $page . '">' . $page . '</a></div>';
                        $_SESSION['auctionItem'] = true;
                    }
                }
                ?>
            </li>
            <li class="page-item">
                <a class="page-link" href="<?php if (isset($view->next)) {echo $view->next;};?>" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        </ul>
    <?php /*endif; */?>

<?php require('template/footer.phtml') ?>
